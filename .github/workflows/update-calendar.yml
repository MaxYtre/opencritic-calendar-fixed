name: Update OpenCritic Calendar

# –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é –ø–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞–º –≤ 6:00 UTC
on:
  schedule:
    - cron: '0 6 * * 1'
  # –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é
  workflow_dispatch:

jobs:
  update-calendar:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests
    
    - name: Run calendar processor
      run: |
        python calendar-processor.py
    
    - name: Check if file was created
      run: |
        if [ -f "opencritic-calendar-filtered.ics" ]; then
          echo "‚úÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω"
          ls -la opencritic-calendar-filtered.ics
          echo "–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: $(du -h opencritic-calendar-filtered.ics | cut -f1)"
        else
          echo "‚ùå –û—à–∏–±–∫–∞: —Ñ–∞–π–ª –∫–∞–ª–µ–Ω–¥–∞—Ä—è –Ω–µ —Å–æ–∑–¥–∞–Ω"
          exit 1
        fi
    
    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å
        git add opencritic-calendar-filtered.ics
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        if git diff --staged --quiet; then
          echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ"
        else
          echo "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è, –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å"
          git commit -m "üóìÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è OpenCritic ($(date '+%Y-%m-%d %H:%M UTC'))"
          git push
        fi
    
    - name: Display calendar info
      run: |
        if [ -f "opencritic-calendar-filtered.ics" ]; then
          echo "üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ:"
          echo "–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: $(stat --format=%s opencritic-calendar-filtered.ics) –±–∞–π—Ç"
          echo "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π: $(grep -c 'BEGIN:VEVENT' opencritic-calendar-filtered.ics || echo '0')"
          echo ""
          echo "üîó –°—Å—ã–ª–∫–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Google Calendar:"
          echo "https://maxytre.github.io/opencritic-calendar-fixed/opencritic-calendar-filtered.ics"
        fi
